local teleportCFrame = CFrame.new(Vector3.new(9, 1.1, 53)) -- destination

-- Correct order
local correctOrder = { "Block3", "Block1", "Block2" }

-- Track click sequences per player
local playerClickSequences = {}

-- Reference to siren part
local siren = workspace:WaitForChild("Siren")
local defaultColor = BrickColor.new("Lime green")
local errorColor = BrickColor.new("Bright red")

-- Flash siren red for 2 seconds
local function flashSiren()
	siren.BrickColor = errorColor
	task.delay(2, function()
		siren.BrickColor = defaultColor
	end)
end

-- Handle block click
local function onBlockClicked(player, blockName)
	if not playerClickSequences[player] then
		playerClickSequences[player] = {}
	end

	local sequence = playerClickSequences[player]
	table.insert(sequence, blockName)

	-- Check correctness so far
	for i = 1, #sequence do
		if sequence[i] ~= correctOrder[i] then
			playerClickSequences[player] = {} -- reset on wrong
			flashSiren()
			return
		end
	end

	-- Check full match
	if #sequence == #correctOrder then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			char:MoveTo(teleportCFrame.Position)

			-- Teleport Rig as well
			local rig = workspace:FindFirstChild("Rig")
			if rig and rig:FindFirstChild("HumanoidRootPart") then
				rig:MoveTo(teleportCFrame.Position + Vector3.new(3, 0, 0)) 
				-- offset so Rig doesnâ€™t overlap player
			end
		end
		playerClickSequences[player] = {} -- reset after success
	end
end

-- Connect all blocks
local function setupClickDetector(partName)
	local part = workspace:WaitForChild(partName)
	local clickDetector = part:WaitForChild("ClickDetector")

	clickDetector.MouseClick:Connect(function(player)
		onBlockClicked(player, partName)
	end)
end

setupClickDetector("Block1")
setupClickDetector("Block2")
setupClickDetector("Block3")
